define(["require","city","view-manager","ui-toolbox","weather-source-api"],function(e){function u(){this.theView=null,this.theCities=[],this.settings={cities:[],sortMethod:"name"}}var t=e("city"),n=e("view-manager"),r=e("ui-toolbox"),i=e("weather-source-api"),s=!0,o=0;return u.prototype={onSortMethodChanged:function(e,t){var n=t!=null?t.currentTarget:null;console&&console.log("[main] onSortMethodChanged:"+n.value),e.settings.sortMethod=n.value,e.theView.render(e.settings.sortMethod)},viewListDisplay:function(e){e.theView.renderCityList()},cityFullDisplay:function(e,t){for(var n=0;n<e.theCities.length;n++)e.theCities[n].id==t&&e.theView.renderFullCity(e.theCities[n])},Init:function(e,r){var s=this;e.cities&&(this.settings.cities=e.cities),e.sortMethod&&(this.settings.sortMethod=e.sortMethod);for(var o=0;o<this.settings.cities.length;o++){var u=new t({id:this.settings.cities[o].id,name:this.settings.cities[o].name});this.theCities.push(u)}var a={sortByArea:{selector:"#sortBy",func:null},viewListArea:{selector:"#viewList",func:s.viewListDisplay},fullDisplayArea:{selector:"#fullDisplayArea",func:null},tmplCity:{selector:"#tmplCity",func:null},tmplIcon:{selector:"#tmplIcon",func:null},cityListInsertionPoint:{selector:"#city-list",func:null},sortMethod:{selector:"#sortMethod",func:s.onSortMethodChanged},cityDiv:{selector:"div.city",func:s.cityFullDisplay}};return this.theView=new n(this,a),this.theView.setCities(this.theCities),this.theView.render(this.settings.sortMethod),i.Fetch(this.theCities,function(e){s.theView.render(s.settings.sortMethod),r&&r(e)}),this}},u});